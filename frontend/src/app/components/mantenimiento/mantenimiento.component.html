<div class="mantenimiento-container">

  <h1>Mantenimiento</h1>

  <!-- Sección: Carga Masiva -->
  <div class="seccion" *ngIf="esAdmin">
    <h2>Carga Masiva de Usuarios</h2>
    <input type="file" (change)="onArchivoSeleccionado($event)" accept=".xlsx, .csv">
    <button (click)="subirArchivo()">Subir Archivo</button>

    <div *ngIf="resultado">
      <h3>Resultado</h3>
      <p>Usuarios insertados: {{ resultado.insertados }}</p>
      <div *ngIf="resultado.errores?.length > 0">
        <h4>Errores:</h4>
        <ul>
          <li *ngFor="let error of resultado.errores">
            Persona ID: {{ error.row.Persona_id }} - Error: {{ error.error }}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Editar usuarios -->
  <div class="seccion" *ngIf="esAdmin">
    <h2>Editar Persona</h2>
    <ul>
      <li 
        *ngFor="let persona of personas" 
        (click)="seleccionarPersona(persona)"
        [ngClass]="{'seleccionada': persona === personaSeleccionada}">
        {{ persona.nombres }} {{ persona.apellidos }}
      </li>
    </ul>
  </div>

  <!-- Formulario de edición -->
  <div class="seccion" *ngIf="personaSeleccionada">
    <div class="editar-header">
      <h3>Editar Datos</h3>
      <button class="cerrar-btn" (click)="personaSeleccionada = null" title="Cerrar edición">✖</button>
    </div>

    <div *ngIf="mensajeActualizacion" [ngClass]="{'alert': true, 'alert-success': mensajeTipo === 'success', 'alert-danger': mensajeTipo === 'error'}">
      {{ mensajeActualizacion }}
    </div>

    <form (ngSubmit)="actualizarPersona()">
      <label>Nombres:</label>
      <input type="text" [(ngModel)]="personaSeleccionada.Nombres" name="nombres"><br>

      <label>Apellidos:</label>
      <input type="text" [(ngModel)]="personaSeleccionada.Apellidos" name="apellidos"><br>

      <label>Identificación:</label>
      <input type="text" [(ngModel)]="personaSeleccionada.Identificacion" name="identificacion"><br>

      <label>Fecha de Nacimiento:</label>
      <input type="date" [(ngModel)]="personaSeleccionada.FechaNacimiento" name="fechaNacimiento"><br>

      <button type="submit">Actualizar</button>
    </form>
  </div>

  <!-- Gestión de Estados -->
  <div class="seccion" *ngIf="esAdmin">
    <h2>Gestión de Estados de Usuarios</h2>
    <ul>
      <li *ngFor="let usuario of estadosUsuarios">
        <span>{{ usuario.UserName }} - Estado: {{ usuario.Status }}</span><br>
        <select [(ngModel)]="usuario.estado" (change)="actualizarEstado(usuario.id, usuario.estado)">
          <option value="activo">Activo</option>
          <option value="inactivo">Inactivo</option>
          <option value="bloqueado">Bloqueado</option>
        </select>
      </li>
    </ul>
    <div *ngIf="mensajeActualizacion" [ngClass]="{'alert': true, 'alert-success': mensajeTipo === 'success', 'alert-danger': mensajeTipo === 'error'}">
      {{ mensajeActualizacion }}
    </div>
  </div>

  <!-- Buscar personas -->
  <div class="seccion" *ngIf="esAdmin">
    <h2>Buscar Personas</h2>
    <input [(ngModel)]="nombre" placeholder="Nombre" />
    <input [(ngModel)]="apellido" placeholder="Apellido" />
    <button (click)="buscarPersonas()">Buscar</button>

    <div *ngIf="personasBusqueda.length > 0">
      <ul>
        <li *ngFor="let persona of personasBusqueda">
          {{ persona.Nombres }} {{ persona.Apellidos }}
        </li>
      </ul>
    </div>

    <div *ngIf="mensajeBusqueda">
      <p>{{ mensajeBusqueda }}</p>
    </div>
  </div>
</div>
